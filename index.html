<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spice</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>

    <!-- Custom Title Bar -->
    <div id="title-bar">
        <div class="nav-controls" id="nav-container">
            <button id="btn-back" class="nav-btn" title="Back">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" />
                </svg>
            </button>

            <button id="btn-reload" class="nav-btn" title="Reload">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" />
                </svg>
            </button>
            <button id="btn-url" class="nav-btn" title="Open URL">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                </svg>
            </button>
            <button id="btn-home" class="nav-btn" title="Home">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg>
            </button>
        </div>
        <!-- Right Side Controls (Settings + Window Ops) -->
        <div class="title-right">
            <button id="btn-volume" class="nav-btn" title="Boost Volume 1000%">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
                </svg>
            </button>
            <!-- Volume Slider Popup -->
            <div id="volume-popup" class="volume-popup hidden">
                <div class="volume-slider-container">
                    <input type="range" min="1" max="10" step="0.1" value="1" class="volume-slider" id="volume-range"
                        title="Volume Boost">
                </div>
                <div class="volume-value" id="volume-text">100%</div>
            </div>
            <button id="btn-settings" class="nav-btn" title="Settings">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor"
                        d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L3.16 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.04.64.09.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                </svg>
            </button>
            <div class="window-controls">
                <button id="btn-min" class="win-btn" title="Minimize">
                    <svg viewBox="0 0 12 12">
                        <path fill="currentColor" d="M11 6H1V5h10v1z" />
                    </svg>
                </button>
                <button id="btn-max" class="win-btn" title="Maximize">
                    <svg viewBox="0 0 12 12">
                        <path fill="currentColor" d="M1 1v10h10V1H1zm1 9V2h8v8H2z" />
                    </svg>
                </button>
                <button id="btn-close" class="win-btn win-close" title="Close">
                    <svg viewBox="0 0 12 12">
                        <path fill="currentColor"
                            d="M11 1.7L10.3 1 6 5.3 1.7 1 1 1.7 5.3 6 1 10.3 1.7 11 6 6.7 10.3 11 11 10.3 6.7 6z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- URL Input Modal -->
    <div id="url-modal" class="modal hidden">
        <div class="modal-content">
            <h3>Open URL</h3>
            <p class="modal-hint">Only YouTube Music and SoundCloud links are allowed</p>
            <input type="url" id="url-input" placeholder="https://music.youtube.com/... or https://soundcloud.com/..."
                autocomplete="off">
            <div class="modal-error hidden" id="url-error">Invalid URL. Only YouTube Music and SoundCloud links are
                allowed.</div>
            <div class="modal-buttons">
                <button id="url-cancel" class="modal-btn cancel">Cancel</button>
                <button id="url-go" class="modal-btn primary">Go</button>
            </div>
        </div>
    </div>


    <!-- Homepage Selection -->
    <div id="home-container">
        <h1>Welcome to Spice</h1>
        <div class="card-container">
            <button class="service-card yt-music" onclick="window.api.loadService('yt')">
                <div class="card-icon">
                    <!-- Simple Play Icon for visual -->
                    <svg viewBox="0 0 24 24" width="64" height="64">
                        <path fill="currentColor" d="M8 5v14l11-7z" />
                    </svg>
                </div>
                <h2>YouTube Music</h2>
            </button>
            <button class="service-card soundcloud" onclick="window.api.loadService('sc')">
                <div class="card-icon">
                    <!-- Cloud Icon for visual -->
                    <svg viewBox="0 0 24 24" width="64" height="64">
                        <path fill="currentColor"
                            d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z" />
                    </svg>
                </div>
                <h2>SoundCloud</h2>
            </button>
        </div>
    </div>

    <script>
        function loadService(service) {
            console.log('Renderer: Clicking service card', service);
            if (window.api && window.api.loadService) {
                window.api.loadService(service);
            } else {
                console.error('API not exposed!');
            }
        }

        // Setup Navigation Listeners
        // Setup Navigation Listeners
        document.getElementById('btn-back').addEventListener('click', () => window.api.navigate('back'));
        document.getElementById('btn-reload').addEventListener('click', () => window.api.navigate('reload'));
        document.getElementById('btn-home').addEventListener('click', () => window.api.navigate('home'));
        document.getElementById('btn-settings').addEventListener('click', () => window.api.openSettings());

        // URL Modal
        const btnUrl = document.getElementById('btn-url');
        const urlModal = document.getElementById('url-modal');
        const urlInput = document.getElementById('url-input');
        const urlError = document.getElementById('url-error');
        const urlCancel = document.getElementById('url-cancel');
        const urlGo = document.getElementById('url-go');

        function isValidUrl(url) {
            try {
                const parsed = new URL(url);
                const host = parsed.hostname.toLowerCase();
                return host === 'music.youtube.com' ||
                    host === 'www.music.youtube.com' ||
                    host === 'soundcloud.com' ||
                    host === 'www.soundcloud.com' ||
                    host === 'm.soundcloud.com';
            } catch {
                return false;
            }
        }

        function openUrlModal() {
            // Hide browser view so modal is visible
            if (window.api.hideView) window.api.hideView();
            urlModal.classList.remove('hidden');
            urlInput.value = '';
            urlError.classList.add('hidden');
            setTimeout(() => urlInput.focus(), 100);
        }

        function closeUrlModal() {
            urlModal.classList.add('hidden');
            urlInput.value = '';
            urlError.classList.add('hidden');
            // Show browser view again
            if (window.api.showView) window.api.showView();
        }

        function goToUrl() {
            const url = urlInput.value.trim();
            if (!url) return;

            if (isValidUrl(url)) {
                window.api.loadUrl(url);
                closeUrlModal();
            } else {
                urlError.classList.remove('hidden');
            }
        }

        btnUrl.addEventListener('click', openUrlModal);
        urlCancel.addEventListener('click', closeUrlModal);
        urlGo.addEventListener('click', goToUrl);

        // Close on backdrop click
        urlModal.addEventListener('click', (e) => {
            if (e.target === urlModal) closeUrlModal();
        });

        // Enter key to submit
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') goToUrl();
        });

        // Clear error on input
        urlInput.addEventListener('input', () => {
            urlError.classList.add('hidden');
        });

        // Volume Controls
        const btnVolume = document.getElementById('btn-volume');
        const volPopup = document.getElementById('volume-popup');
        const volRange = document.getElementById('volume-range');
        const volText = document.getElementById('volume-text');

        btnVolume.addEventListener('click', (e) => {
            e.stopPropagation();
            volPopup.classList.toggle('hidden');
        });

        // Close popup when clicking outside
        document.addEventListener('click', (e) => {
            if (!volPopup.contains(e.target) && !btnVolume.contains(e.target)) {
                volPopup.classList.add('hidden');
            }
        });

        volRange.addEventListener('input', (e) => {
            const val = e.target.value;
            window.api.setVolume(val);
            volText.innerText = Math.round(val * 100) + '%';
        });

        // Window Controls
        document.getElementById('btn-min').addEventListener('click', () => window.api.windowControls.minimize());
        document.getElementById('btn-max').addEventListener('click', () => window.api.windowControls.maximize());
        document.getElementById('btn-close').addEventListener('click', () => window.api.windowControls.close());

        // Handle Active State
        const homeContainer = document.getElementById('home-container');
        // Nav container is always visible now

        window.api.onServiceActive((active) => {
            if (active) {
                homeContainer.classList.add('hidden');
                document.body.style.backgroundColor = '#000';
            } else {
                homeContainer.classList.remove('hidden');
                document.body.style.backgroundColor = '';
            }
        });
    </script>
</body>

</html>